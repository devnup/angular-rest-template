angular.module("com.devnup.rest.cache.bucket",["com.devnup.rest.cache.storage","com.devnup.rest.util"]).factory("$cacheBucket",["$storageWrapper","$restUtil","$timeout",function(a,c,d){a.$local().$default({bucket:{},config:{min:5e3,max:6e4}});var e={},f={},g=a.$local(),h=function(a,b,i){return i=i||{},g[a]=b=b||g[a]||h.construct(a,i),i&&i.refresh&&(e[a]=i.refresh),b.refresh=function(){if(e[a]){var h=!!b._data&&Object.keys(b._data).length,j=Date.now()-b.lastUpdated,k={min:i.min||b.timeout.min||g.config.min,max:i.max||b.timeout.max||g.config.max};if(!b.refreshing&&(!h||j>k.min))return b.refreshing=!0,c.callback({method:e[a](),success:function(c){b.lastUpdated=Date.now(),b._data=c,b.timeout.id=d(function(){b.refresh(f[a])},b.lastUpdated+k.max-Date.now()),b.refreshing=!1},error:function(){var c=b.lastUpdated+k.max-Date.now();b.timeout.id=d(function(){b.refresh(f[a])},c>=k.min?c:k.min),b.refreshing=!1}})}return b.request()},b.request=function(){var a={error:function(){return a},success:function(c){return c(b._data),a}};return a},b.data=function(){return b.data},b.clear=function(){h.destroy(a)},b};return h.selector=function(a,b){return g.bucket[a]?h(a,g.bucket[a],b):h.construct(a,b)},h.construct=function(a,c){c=c||{};var d=Date.now();return g.config=g.config||[],e[a]=c.refresh||angular.noop,g.bucket[a]={createdAt:d,lastUpdated:d,refreshing:!1,_data:{},timeout:{min:c.min||g.config.min,max:c.max||g.config.max,id:null}},h(b)},h.destroy=function(a){a?g.bucket[a]={}:g={}},h.config=function(a){a=a||{};for(var b in a)a.hasOwnProperty(b)&&(g.config[b]=a[b]||g[b])},h}]),angular.module("com.devnup.rest.cache.storage",["ngStorage"]).factory("$storageWrapper",["$rootScope","$localStorage","$sessionStorage",function(a,b,c){if(!b||!c)throw new Error("ngStorage is required");return{$local:function(){return b},$session:function(){return c}}}]),angular.module("com.devnup.rest.cache",["com.devnup.rest.cache.storage","com.devnup.rest.cache.bucket","com.devnup.rest.util"]).factory("$cache",["$cacheBucket",function(a){return{bucket:function(b,c){return a.selector(b,c)},destroy:function(b){return a.destroy(b)},config:function(b){return a.config(b)}}}]),angular.module("com.devnup.rest",["com.devnup.rest.cache","com.devnup.rest.util"]).factory("$rest",["$restUtil","$http","$cache",function(a,b,c){var d="/api/",e=!1,f=function(){return!!e},g=function(){this.callback=a.callback,this.config=function(a){d=a.base,e=a.cache,c.config(e)},this.get=function(e,g,h){var i=b.get;if(h=h||{cache:!1},f()&&h.cache!==!1&&h.cache.enabled!==!1){var j=c.bucket("GET:"+e,{refresh:function(){return a.wrapper(i,[d+e,g,h.cache])}});return j.refresh()}return a.wrapper(i,[d+e,g,h.cache])},this.post=function(e,g,h){var i=b.post;if(h=h||{cache:!1},f()&&h.cache!==!1){var j=c.bucket("POST:"+e,{refresh:function(){return a.wrapper(i,[d+e,g,h.cache])}});return j.refresh()}return a.wrapper(i,[d+e,g,h.cache])},this.put=function(e,g){var h=b.put;if(config=config||{cache:!1},f()&&config.cache!==!1){var i=c.bucket("PUT:"+e,{refresh:function(){return a.wrapper(h,[d+e,g,config.cache])}});return i.refresh()}return a.wrapper(h,[d+e,g,config.cache])},this["delete"]=function(e,g,h){var i=b["delete"];if(h=h||{cache:!1},f()&&h.cache!==!1){var j=c.bucket("DEL:"+e,{refresh:function(){return a.wrapper(i,[d+e,g,h.cache])}});return j.refresh()}return a.wrapper(i,[d+e,g,h.cache])}};return g.prototype.build=function(a){var b=new g;return b.config(a),b},new g}]),angular.module("com.devnup.rest.util",[]).factory("$restUtil",[function(){if(!async)throw new Error("async is required");var a={};return a.wrapper=function(a,b){var c={success:angular.noop,error:angular.noop};a.apply(this,b).success(function(a){c.success(a)}).error(function(a){c.error(a)});var d={success:function(a){return c.success=a,d},error:function(a){return c.error=a,d}};return d},a.callback=function(a){var b={success:angular.noop,error:angular.noop};a=a||{},a.method=a.method||angular.copy(b),a.success=a.success||angular.noop,a.error=a.success||angular.noop,a.method.success(function(c){c.error?(a.error(c.error),b.error(c.error)):(a.success(c),b.success(c))}).error(function(c){a.error(c),b.error(c)});var c={success:function(a){return b.success=a,c},error:function(a){return b.error=a,c}};return c},a.$async=async,a}]);