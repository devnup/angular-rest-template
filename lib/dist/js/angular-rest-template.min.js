angular.module("com.devnup.rest.cache.bucket",["com.devnup.rest.cache.storage","com.devnup.rest.util"]).factory("$cacheBucket",["$storageWrapper","$restUtil","$timeout",function(a,b,c){a.$local().$default({bucket:{},config:{min:5e3,max:6e4}});var d={},e={},f=a.$local();f.bucket=f.bucket||{};var g=function(a,h,i){return i=i||{},h=h||f.bucket[a],i&&(e[a]=i.refresh||e[a],d[a]=d[a]||"".concat(i.hash),h&&(h.timeout=h.timeout||{min:f.config.min,max:f.config.max},h.timeout.min=i.min||h.timeout.min,h.timeout.max=i.max||h.timeout.max)),h.refresh=function(){if(e[a]){var g=!!h._data&&Object.keys(h._data).length,i=Date.now()-h.lastUpdated,j=!0;d[a]&&typeof d==typeof angular.noop&&(j=j||d[a]()===h.lastUpdatedHash),d[a]&&"string"==typeof d&&(j=j||d[a]===h.lastUpdatedHash);var k={min:h.timeout.min||f.config.min,max:h.timeout.max||f.config.max};if(!h.refreshing&&(!g||i>k.min||!j))return h.refreshing=!0,b.callback({method:e[a](),success:function(d){h.lastUpdated=Date.now(),h._data=d,h.timeout.id=c(function(){0!==Object.keys(f.bucket[a]).length&&h.refresh()},h.lastUpdated+k.max-Date.now()),h.refreshing=!1;var e=b.cache(a);e&&typeof e.success==typeof angular.noop&&e.success(d)},error:function(){var d=h.lastUpdated+k.max-Date.now();h.timeout.id=c(function(){0!==Object.keys(f.bucket[a]).length&&h.refresh()},d>=k.min?d:k.min),h.refreshing=!1;var e=b.cache(a);e&&typeof e.error==typeof angular.noop&&e.error(data)}})}return h.request()},h.request=function(){var a={error:function(){return a},success:function(b){return b(h._data),a}};return a},h.data=function(){return h.data},h.clear=function(){g.destroy(a)},h};return g.selector=function(a,b){return f.bucket=f.bucket||{},f.bucket[a]?g(a,f.bucket[a],b):g.construct(a,b)},g.construct=function(a,b){b=b||{};var c=Date.now();return f.config=f.config||[],f.bucket=f.bucket||{},e[a]=b.refresh||angular.noop,f.bucket[a]={createdAt:c,lastUpdated:c,lastUpdatedHash:null,refreshing:!1,_data:{},timeout:{min:b.min||f.config.min,max:b.max||f.config.max,id:null}},g(a)},g.destroy=function(a){f.bucket=f.bucket||{},a?f.bucket[a]={}:f={}},g.config=function(a){a=a||{};for(var b in a)a.hasOwnProperty(b)&&(f.config[b]=a[b]||f[b])},g}]),angular.module("com.devnup.rest.cache.storage",["ngStorage"]).factory("$storageWrapper",["$rootScope","$localStorage","$sessionStorage",function(a,b,c){if(!b||!c)throw new Error("ngStorage is required");return{$local:function(){return b},$session:function(){return c}}}]),angular.module("com.devnup.rest.cache",["com.devnup.rest.cache.storage","com.devnup.rest.cache.bucket","com.devnup.rest.util"]).factory("$cache",["$cacheBucket",function(a){return{bucket:function(b,c){return a.selector(b,c)},destroy:function(b){return a.destroy(b)},config:function(b){return a.config(b)}}}]),angular.module("com.devnup.rest",["com.devnup.rest.cache","com.devnup.rest.util"]).factory("$rest",["$restUtil","$http","$cache",function(a,b,c){var d=function(){var d={base:"",cache:!1},e=function(){return!!d.cache};this.callback=a.callback,this.config=function(a){return a&&(d.base=a.base||d.base,d.cache=a.cache||d.cache,c.config(d.cache)),d},this.request=function(f,g,h,i){var j=function(a,c,e){return b({method:f.toUpperCase(),url:a,params:"get"===f.toLowerCase()?c:{},data:"get"!==f.toLowerCase()?c:{},headers:d.headers||{}})};h=h||{},i=i||d.cache||{cache:!1};var k=i.base||d.base;if(e()||i.cache!==!1&&i.cache.enabled!==!1){var l=c.bucket(g,{min:i.cache.min?parseInt(i.cache.min):i.cache.min,max:i.cache.max?parseInt(i.cache.max):i.cache.max,hash:function(){return JSON.stringify(h)},refresh:function(){return a.wrapper(j,[k+g,h,d.cache])}});return l.refresh()}return c.destroy(g),new a.wrapper(j,[d.base+g,h,d.cache])},this.get=function(a,b,c){var d=["get"].concat(Array.prototype.slice.call(arguments));return this.request.apply(this,d)},this.post=function(a,b,c){var d=["post"].concat(Array.prototype.slice.call(arguments));return this.request.apply(this,d)},this.put=function(a,b){var c=["put"].concat(Array.prototype.slice.call(arguments));return this.request.apply(this,c)},this["delete"]=function(a,b,c){var d=["delete"].concat(Array.prototype.slice.call(arguments));return this.request.apply(this,d)}};return d.prototype.build=function(a){var b=new d;return b.config(a),b},new d}]),angular.module("com.devnup.rest.util",[]).factory("$restUtil",[function(){if(!async)throw new Error("async is required");var a={},b={};return a.cache=function(a){return b[a]},a.wrapper=function(a,c){var d=c[0],e={success:angular.noop,error:angular.noop};a.apply(this,c).success(function(a){e.success(a)}).error(function(a){e.error(a)});var f={success:function(a,c){return e.success=a,c||(b[d]=b[d]||e,b[d].success=a),f},error:function(a,c){return e.error=a,c&&(b[d]=b[d]||e,b[d].error=a),f}};return f},a.callback=function(a){var b={success:angular.noop,error:angular.noop};a=a||{},a.method=a.method||angular.copy(b),a.success=a.success||angular.noop,a.error=a.success||angular.noop,a.method.success(function(c){c.error?(a.error(c.error),b.error(c.error)):(a.success(c),b.success(c))},!0).error(function(c){a.error(c),b.error(c)},!0);var c={success:function(a){return b.success=a,c},error:function(a){return b.error=a,c}};return c},a.$async=async,a}]);